<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skin Studio-mcpe</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --bg-app: #0a0514;
            --bg-panel: #160d2b;
            --primary: #8a2be2; /* BlueViolet */
            --primary-glow: #b066ff;
            --text-main: #f0f0f0;
            --text-muted: #8e80ac;
            --border: #2d1b4d;
            --white: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body {
            margin: 0;
            background-color: var(--bg-app);
            color: var(--text-main);
            font-family: 'Segoe UI', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            height: 65px;
            background: var(--bg-panel);
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        .header-left { display: flex; align-items: center; gap: 25px; }
        
        .home-link {
            color: var(--text-main);
            text-decoration: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
            padding: 8px 12px;
            border-radius: 8px;
        }
        .home-link:hover { background: rgba(138, 43, 226, 0.2); color: var(--primary-glow); }

        .brand { font-weight: 900; font-size: 1.3rem; color: var(--primary-glow); text-shadow: 0 0 10px var(--primary); }

        .header-controls { display: flex; gap: 12px; align-items: center; }

        .model-selector {
            background: #000;
            border-radius: 20px;
            padding: 3px;
            display: flex;
            border: 1px solid var(--border);
        }
        .m-btn {
            padding: 5px 15px; border: none; background: none; color: var(--text-muted);
            cursor: pointer; border-radius: 15px; font-weight: bold; font-size: 0.8rem;
        }
        .m-btn.active { background: var(--primary); color: white; box-shadow: 0 0 10px var(--primary); }

        .btn {
            background: var(--primary); color: white; border: none;
            padding: 10px 18px; border-radius: 8px; cursor: pointer;
            font-weight: 600; transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .btn:hover { background: var(--primary-glow); transform: translateY(-2px); }

        /* --- LAYOUT --- */
        main { display: flex; flex: 1; height: calc(100vh - 65px); }

        /* EDITOR (LADO ESQUERDO) */
        #editor-container {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; position: relative;
            background: radial-gradient(circle, #1a0b33 0%, #0a0514 100%);
        }

        .canvas-area {
            position: relative;
            padding: 10px;
            background: #111;
            border: 3px solid var(--primary);
            box-shadow: 0 0 40px rgba(0,0,0,0.8);
            border-radius: 4px;
        }

        canvas {
            image-rendering: pixelated;
            width: 512px; height: 512px;
            cursor: crosshair;
            background-color: transparent;
        }

        /* ÁREAS DE TEXTURA (GUIA VISUAL) */
        .guide-label {
            position: absolute; color: white; font-size: 10px; pointer-events: none;
            font-weight: bold; text-transform: uppercase; opacity: 0.7;
        }

        /* PREVIEW (LADO DIREITO) */
        #preview-container {
            width: 420px; background: #0f0a1d; border-left: 2px solid var(--border);
            position: relative;
        }

        #renderer-target { width: 100%; height: 100%; cursor: grab; }

        /* TOOLBAR */
        .toolbar {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(22, 13, 43, 0.9); backdrop-filter: blur(10px);
            padding: 12px 25px; border-radius: 50px; display: flex; align-items: center;
            gap: 20px; border: 1px solid var(--primary); box-shadow: 0 0 30px rgba(138, 43, 226, 0.2);
        }

        .tool-btn {
            background: none; border: none; color: var(--text-muted);
            font-size: 1.3rem; cursor: pointer; transition: 0.2s;
        }
        .tool-btn.active { color: var(--primary-glow); filter: drop-shadow(0 0 5px var(--primary)); }

        input[type="color"] {
            width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--white);
            cursor: pointer; padding: 0; overflow: hidden;
        }

        /* MOBILE NAVIGATION */
        .mobile-tabs { display: none; }

        @media (max-width: 900px) {
            main { flex-direction: column; }
            #preview-container { display: none; width: 100%; height: 100%; }
            canvas { width: 90vw; height: 90vw; }
            .mobile-tabs {
                display: flex; height: 65px; background: var(--bg-panel);
                border-top: 2px solid var(--primary); position: fixed; bottom: 0; width: 100%;
                justify-content: space-around; align-items: center;
            }
            .tab-btn { background: none; border: none; color: var(--text-muted); display: flex; flex-direction: column; align-items: center; gap: 4px; }
            .tab-btn.active { color: var(--primary-glow); }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-left">
            <a href="home.html" class="home-link"><i class="fas fa-home"></i> Home</a>
            <div class="brand">SKIN STUDIO</div>
        </div>

        <div class="header-controls">
            <div class="model-selector">
                <button class="m-btn active" id="btnSteve" onclick="changeModel('steve')">STEVE</button>
                <button class="m-btn" id="btnAlex" onclick="changeModel('alex')">ALEX</button>
            </div>
            
            <input type="file" id="importFile" style="display: none" accept="image/png">
            <button class="btn" onclick="document.getElementById('importFile').click()">
                <i class="fas fa-file-import"></i> <span>Importar</span>
            </button>
            <button class="btn" style="background: var(--white); color: var(--bg-app);" onclick="saveSkin()">
                <i class="fas fa-save"></i> <span>Salvar</span>
            </button>
        </div>
    </header>

    <main>
        <section id="editor-container">
            <div class="canvas-area">
                <canvas id="skinCanvas" width="64" height="64"></canvas>
                <div class="guide-label" style="top: 10px; left: 10px;">Cabeça</div>
                <div class="guide-label" style="top: 170px; left: 140px;">Tronco</div>
                <div class="guide-label" style="top: 170px; left: 10px;">Braço D</div>
                <div class="guide-label" style="top: 170px; left: 330px;">Braço E</div>
                <div class="guide-label" style="top: 380px; left: 10px;">Perna D</div>
                <div class="guide-label" style="top: 380px; left: 140px;">Perna E</div>
            </div>

            <div class="toolbar">
                <input type="color" id="colorPicker" value="#8a2be2">
                <button class="tool-btn active" id="toolPencil" onclick="setTool('pencil')"><i class="fas fa-pen-nib"></i></button>
                <button class="tool-btn" id="toolEraser" onclick="setTool('eraser')"><i class="fas fa-eraser"></i></button>
                <div style="width: 1px; height: 30px; background: var(--border);"></div>
                <button class="tool-btn" onclick="clearAll()"><i class="fas fa-trash-alt"></i></button>
            </div>
        </section>

        <section id="preview-container">
            <div id="renderer-target"></div>
        </section>
    </main>

    <nav class="mobile-tabs">
        <button class="tab-btn active" onclick="switchTab('editor')"><i class="fas fa-edit"></i> Editor</button>
        <button class="tab-btn" onclick="switchTab('preview')"><i class="fas fa-cube"></i> Visualizar</button>
    </nav>

    <script>
        const canvas = document.getElementById('skinCanvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        let isDrawing = false;
        let activeTool = 'pencil';
        let currentModel = 'steve';

        // Inicializar Canvas com Template do Minecraft
        function initCanvasTemplate() {
            ctx.clearRect(0, 0, 64, 64);
            
            // Desenhar Guia de Layout (Bordas leves para o usuário saber as áreas)
            ctx.lineWidth = 0.5;
            const drawArea = (x, y, w, h, label) => {
                ctx.strokeStyle = 'rgba(138, 43, 226, 0.3)';
                ctx.strokeRect(x, y, w, h);
            };

            drawArea(8, 0, 24, 16);    // Cabeça
            drawArea(16, 16, 24, 16);  // Tronco e Perna
            drawArea(0, 16, 16, 16);   // Braço D
            drawArea(40, 16, 16, 16);  // Braço E
            drawArea(0, 32, 16, 16);   // Perna D
            drawArea(16, 32, 16, 16);  // Perna E
        }
        initCanvasTemplate();

        // LOGICA DE DESENHO
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: Math.floor((clientX - rect.left) / (rect.width / 64)),
                y: Math.floor((clientY - rect.top) / (rect.height / 64))
            };
        }

        function handleDraw(e) {
            if (!isDrawing) return;
            if (e.cancelable) e.preventDefault();
            const { x, y } = getMousePos(e);
            if (x < 0 || x >= 64 || y < 0 || y >= 64) return;

            if (activeTool === 'pencil') {
                ctx.fillStyle = colorPicker.value;
                ctx.fillRect(x, y, 1, 1);
            } else {
                ctx.clearRect(x, y, 1, 1);
            }
            update3D();
        }

        canvas.addEventListener('mousedown', () => isDrawing = true);
        window.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mousemove', handleDraw);
        canvas.addEventListener('touchstart', (e) => { isDrawing = true; handleDraw(e); }, {passive: false});
        canvas.addEventListener('touchmove', handleDraw, {passive: false});

        function setTool(tool) {
            activeTool = tool;
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tool === 'pencil' ? 'toolPencil' : 'toolEraser').classList.add('active');
        }

        function clearAll() { if(confirm("Limpar tela?")) { initCanvasTemplate(); update3D(); } }

        // IMPORTAR SKIN
        document.getElementById('importFile').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    ctx.clearRect(0,0,64,64);
                    ctx.drawImage(img, 0, 0, 64, 64);
                    update3D();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        function saveSkin() {
            const link = document.createElement('a');
            link.download = 'custom_skin.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // --- VISUALIZADOR 3D (THREE.JS) ---
        let scene, camera, renderer, steve, skinTex;

        function init3D() {
            const target = document.getElementById('renderer-target');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, target.clientWidth / target.clientHeight, 0.1, 100);
            camera.position.set(0, 0, 35);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(target.clientWidth, target.clientHeight);
            target.appendChild(renderer.domElement);

            const light = new THREE.AmbientLight(0xffffff, 1);
            scene.add(light);

            skinTex = new THREE.CanvasTexture(canvas);
            skinTex.magFilter = THREE.NearestFilter;
            skinTex.minFilter = THREE.NearestFilter;

            const mat = new THREE.MeshStandardMaterial({ map: skinTex, transparent: true, side: THREE.DoubleSide });

            steve = new THREE.Group();
            
            // Geometrias (Steve/Alex)
            function addBox(w, h, d, x, y, z, name) {
                const mesh = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), mat);
                mesh.position.set(x, y, z);
                mesh.name = name;
                steve.add(mesh);
            }

            addBox(8, 8, 8, 0, 10, 0, 'head');   // Cabeça
            addBox(8, 12, 4, 0, 0, 0, 'body');   // Torso
            addBox(4, 12, 4, -2, -12, 0, 'legR'); // Perna D
            addBox(4, 12, 4, 2, -12, 0, 'legL');  // Perna E
            
            // Braços serão atualizados via função
            updateArms3D('steve', mat);

            scene.add(steve);

            function animate() {
                requestAnimationFrame(animate);
                steve.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        function updateArms3D(type, mat) {
            const oldR = steve.getObjectByName('armR');
            const oldL = steve.getObjectByName('armL');
            if(oldR) steve.remove(oldR); if(oldL) steve.remove(oldL);

            const width = type === 'alex' ? 3 : 4;
            const posX = type === 'alex' ? 5.5 : 6;

            const armR = new THREE.Mesh(new THREE.BoxGeometry(width, 12, 4), mat);
            armR.name = 'armR'; armR.position.set(posX, 0, 0);
            
            const armL = new THREE.Mesh(new THREE.BoxGeometry(width, 12, 4), mat);
            armL.name = 'armL'; armL.position.set(-posX, 0, 0);

            steve.add(armR, armL);
        }

        function changeModel(type) {
            currentModel = type;
            document.getElementById('btnSteve').classList.toggle('active', type === 'steve');
            document.getElementById('btnAlex').classList.toggle('active', type === 'alex');
            const mat = steve.getObjectByName('head').material;
            updateArms3D(type, mat);
        }

        function update3D() { skinTex.needsUpdate = true; }

        function switchTab(tab) {
            const ed = document.getElementById('editor-container');
            const pr = document.getElementById('preview-container');
            ed.style.display = tab === 'editor' ? 'flex' : 'none';
            pr.style.display = tab === 'preview' ? 'block' : 'none';
            if(tab === 'preview') window.dispatchEvent(new Event('resize'));
        }

        init3D();
        window.addEventListener('resize', () => {
            const t = document.getElementById('renderer-target');
            camera.aspect = t.clientWidth / t.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(t.clientWidth, t.clientHeight);
        });

    </script>
</body>
</html>
