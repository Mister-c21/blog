<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Others Games</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #8a2be2; /* BlueViolet */
            --bg-color: #f8f8ff; /* GhostWhite */
            --glass: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(138, 43, 226, 0.3);
            --g-blue: #4285F4; --g-red: #EA4335; --g-yellow: #FBBC05; --g-green: #34A853;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); min-height: 100vh; overflow-x: hidden; transition: 0.3s; }

        /* HEADER COM BOTÃO DE VOLTAR */
        header {
            position: fixed; top: 0; width: 100%; height: 65px;
            display: flex; align-items: center; justify-content: center;
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border); z-index: 1000;
        }
        
        .back-nav-btn {
            position: absolute; left: 15px; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            background: var(--glass); border: 1px solid var(--glass-border);
            border-radius: 12px; color: var(--primary); font-size: 1.2rem;
            text-decoration: none; transition: 0.3s;
        }
        .back-nav-btn:hover { background: var(--primary); color: white; }

        header h1 { font-size: 1.2rem; font-weight: 900; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }

        /* TABS NAVEGAÇÃO */
        .tab-nav {
            position: fixed; top: 65px; width: 100%; background: var(--bg-color);
            display: flex; justify-content: center; gap: 10px; padding: 12px 0; z-index: 999;
        }
        .tab-btn {
            padding: 10px 20px; border-radius: 20px; border: 2px solid var(--primary);
            background: transparent; color: var(--primary); font-weight: 800; cursor: pointer; font-size: 0.85rem;
        }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(138, 43, 226, 0.3); }

        /* BUSCA, INFO E VOZ */
        .search-area {
            position: fixed; top: 125px; width: 100%; padding: 10px 20px;
            background: var(--bg-color); z-index: 998; display: none;
            animation: fadeIn 0.3s ease;
        }
        .search-wrapper { position: relative; width: 100%; max-width: 500px; margin: 0 auto; display: flex; align-items: center; }
        .info-btn { position: absolute; left: 15px; color: var(--primary); font-size: 1.2rem; cursor: pointer; border: none; background: none; }
        .search-input { width: 100%; padding: 12px 45px 12px 45px; border-radius: 15px; border: 2px solid var(--glass-border); outline: none; background: white; }
        .voice-btn { position: absolute; right: 15px; color: var(--primary); font-size: 1.2rem; cursor: pointer; border: none; background: none; }

        /* FEED PINTEREST */
        #feed { margin-top: 140px; padding: 15px; column-count: 2; column-gap: 15px; }
        #feed.with-search { margin-top: 195px; }
        @media (min-width: 768px) { #feed { column-count: 4; } }

        .card {
            break-inside: avoid; margin-bottom: 15px; border-radius: 20px;
            overflow: hidden; position: relative; background: white; cursor: pointer;
            border: 1px solid rgba(0,0,0,0.05); transition: 0.3s; animation: cardIn 0.5s ease;
        }
        .card img { width: 100%; display: block; min-height: 120px; object-fit: cover; }
        .card-label {
            position: absolute; bottom: 0; width: 100%; padding: 10px;
            background: linear-gradient(transparent, rgba(138, 43, 226, 0.9));
            color: white; font-weight: bold; font-size: 0.75rem;
        }

        /* MODAIS */
        .modal-full { position: fixed; inset: 0; display: none; background: black; z-index: 5000; }
        .close-modal { position: absolute; top: 20px; right: 20px; width: 45px; height: 45px; border-radius: 50%; border: none; background: var(--primary); color: white; cursor: pointer; font-size: 1.2rem; z-index: 5100; }
        iframe { width: 100%; height: 100%; border: none; }

        #modalInfo {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            z-index: 7000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .info-box { background: white; padding: 30px; border-radius: 25px; width: 85%; max-width: 350px; text-align: center; border: 2px solid var(--primary); }

        /* ASSISTENTE VOZ */
        #assistant-overlay {
            position: fixed; inset: 0; background: rgba(255,255,255,0.96);
            z-index: 6000; display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .bars { display: flex; gap: 8px; margin-top: 20px; height: 40px; align-items: center; }
        .bar { width: 5px; height: 15px; border-radius: 10px; animation: wave 1s infinite ease-in-out; }
        @keyframes wave { 0%, 100% { height: 15px; } 50% { height: 40px; } }

        .load-area { width: 100%; display: none; justify-content: center; padding: 30px; }
        .btn-more { padding: 12px 35px; border-radius: 25px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; }

        @keyframes cardIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ESTILO RETRO */
        .retro-ui .card { border-radius: 0; border: 3px solid #fff; box-shadow: 5px 5px 0 var(--primary); }
        .retro-ui .card-label { font-family: 'Press Start 2P', cursive; font-size: 0.5rem; }
    </style>
</head>
<body id="mainBody">

    <header>
        <a href="../../../More_options.html" class="back-nav-btn">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h1>Games</h1>
    </header>

    <nav class="tab-nav">
        <button id="loreBtn" class="tab-btn active">LoreSpace</button>
        <button id="retroBtn" class="tab-btn">www.retrogames.cc</button>
    </nav>

    <div id="searchBox" class="search-area">
        <div class="search-wrapper">
            <button class="info-btn" id="openInfo"><i class="fas fa-info-circle"></i></button>
            <input type="text" id="searchInput" class="search-input" placeholder="Pesquisar título...">
            <button id="voiceBtn" class="voice-btn"><i class="fas fa-microphone"></i></button>
        </div>
    </div>

    <main id="feed"></main>

    <div id="loadArea" class="load-area">
        <button class="btn-more" onclick="window.open('https://www.retrogames.cc/', '_blank')">Ver Catálogo Completo</button>
    </div>

    <div id="modalInfo">
        <div class="info-box">
            <h3 style="color:var(--primary)">Instruções</h3>
            <p style="margin: 15px 0; font-size: 0.9rem; color: #555;">Clique nos cards para abrir o conteúdo. Use a voz para buscar jogos específicos na aba retrigame.</p>
            <button class="tab-btn active" id="closeInfo" style="width: 100%;">Entendido</button>
        </div>
    </div>

    <div id="universalModal" class="modal-full">
        <button class="close-modal" id="closeModal"><i class="fas fa-times"></i></button>
        <iframe id="mainEmbed" src="" allowfullscreen></iframe>
    </div>

    <div id="assistant-overlay">
        <h2 style="color: #444;">Ouvindo...</h2>
        <div class="bars">
            <div class="bar" style="background:var(--g-blue); animation-delay: 0.1s;"></div>
            <div class="bar" style="background:var(--g-red); animation-delay: 0.2s;"></div>
            <div class="bar" style="background:var(--g-yellow); animation-delay: 0.3s;"></div>
            <div class="bar" style="background:var(--g-green); animation-delay: 0.4s;"></div>
        </div>
    </div>

    <script type="module">
        import { loreData, retroGames } from './dados.js';

        let currentTab = 'lore';

        async function getCapa(title) {
            try {
                const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`);
                const data = await res.json();
                return data.thumbnail ? data.thumbnail.source : "https://via.placeholder.com/400x600?text=Retro+Game";
            } catch { return "https://via.placeholder.com/400x600"; }
        }

        async function render(filtro = '') {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            document.getElementById('loadArea').style.display = currentTab === 'retro' ? 'flex' : 'none';

            const source = currentTab === 'lore' ? loreData : retroGames;

            for (const item of source) {
                if (item.title.toLowerCase().includes(filtro.toLowerCase())) {
                    const img = currentTab === 'retro' ? await getCapa(item.title) : item.img;
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<img src="${img}"><div class="card-label">${item.title}</div>`;
                    
                    card.onclick = () => {
                        const iframe = document.getElementById('mainEmbed');
                        iframe.src = item.url; // Injeção via SRC
                        document.getElementById('universalModal').style.display = 'block';
                    };
                    feed.appendChild(card);
                }
            }
        }

        // TABS
        function switchTab(type, btn) {
            currentTab = type;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('searchBox').style.display = type === 'retro' ? 'block' : 'none';
            document.getElementById('feed').className = type === 'retro' ? 'with-search' : '';
            document.getElementById('mainBody').className = type === 'retro' ? 'retro-ui' : '';
            render();
        }

        document.getElementById('loreBtn').onclick = (e) => switchTab('lore', e.target);
        document.getElementById('retroBtn').onclick = (e) => switchTab('retro', e.target);

        // MODAIS E INFO
        document.getElementById('openInfo').onclick = () => document.getElementById('modalInfo').style.display = 'flex';
        document.getElementById('closeInfo').onclick = () => document.getElementById('modalInfo').style.display = 'none';
        document.getElementById('closeModal').onclick = () => {
            document.getElementById('universalModal').style.display = 'none';
            document.getElementById('mainEmbed').src = ''; // Limpa o src ao fechar
        };

        // PESQUISA POR VOZ
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.lang = 'pt-BR';
        document.getElementById('voiceBtn').onclick = () => {
            document.getElementById('assistant-overlay').style.display = 'flex';
            rec.start();
        };
        rec.onresult = (e) => {
            const text = e.results[0][0].transcript;
            document.getElementById('searchInput').value = text;
            document.getElementById('assistant-overlay').style.display = 'none';
            render(text);
        };

        document.getElementById('searchInput').oninput = (e) => render(e.target.value);

        // Init
        render();
    </script>
</body>
</html>
