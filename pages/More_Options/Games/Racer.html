<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nebula Racer - Pulsing Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600&display=swap');

        :root {
            --neon-purple: #bc13fe;
            --neon-cyan: #05ffa1;
            --bg-deep: #050505;
        }

        body {
            margin: 0; background: var(--bg-deep); color: #fff;
            font-family: 'Inter', sans-serif; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; touch-action: none;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            background: radial-gradient(circle at 50% 50%, #1a0b2e 0%, #050505 100%);
            overflow: hidden;
        }

        canvas { display: block; filter: contrast(1.1) brightness(1.1); }

        .ui-layer {
            position: absolute; top: 30px; left: 30px; right: 30px;
            display: flex; flex-direction: column; gap: 20px;
            pointer-events: none; z-index: 10;
        }

        #score-display {
            font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 3.5rem;
            text-shadow: 0 0 20px var(--neon-purple);
            background: linear-gradient(to bottom, #fff, var(--neon-purple));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .energy-hud { display: flex; align-items: center; gap: 15px; }
        .energy-bar-bg {
            width: 200px; height: 10px; background: rgba(255,255,255,0.05);
            border-radius: 20px; border: 1px solid rgba(5, 255, 161, 0.2);
            overflow: hidden; position: relative;
        }
        #energy-fill {
            width: 100%; height: 100%; background: linear-gradient(90deg, #05ffa1, #00ced1);
            box-shadow: 0 0 15px var(--neon-cyan); transition: width 0.1s linear;
        }

        #overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 20;
        }

        .glass-panel {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08);
            padding: 40px 60px; border-radius: 40px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); min-width: 320px;
        }

        .btn-glow {
            background: #fff; color: #000; padding: 18px 40px;
            border-radius: 12px; font-family: 'Orbitron', sans-serif;
            font-weight: 900; letter-spacing: 2px; cursor: pointer;
            transition: all 0.3s; border: none; text-transform: uppercase;
            width: 100%; margin-bottom: 12px;
        }

        .btn-outline {
            background: transparent; color: #fff; padding: 14px 40px;
            border-radius: 12px; font-family: 'Orbitron', sans-serif;
            font-weight: 900; letter-spacing: 2px; cursor: pointer;
            transition: all 0.3s; border: 1px solid rgba(255,255,255,0.2);
            text-transform: uppercase; width: 100%;
        }
        .btn-outline:hover { background: rgba(255,255,255,0.1); border-color: #fff; }

        #orientation-overlay {
            position: fixed; inset: 0; background: var(--bg-deep);
            z-index: 100; display: none; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        
        @media (orientation: portrait) { #orientation-overlay { display: flex; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="orientation-overlay">
        <i data-lucide="smartphone" class="w-16 h-16 text-cyan-400 mb-6 rotate-90 animate-pulse"></i>
        <h2 class="text-3xl font-black font-['Orbitron'] text-white">ROTEIE O DISPOSITIVO</h2>
    </div>

    <div id="game-container">
        <div class="ui-layer">
            <div class="flex justify-between items-start">
                <div id="score-display">00</div>
                <button id="pause-btn" class="pointer-events-auto p-2"><i data-lucide="pause" class="text-white w-8 h-8"></i></button>
            </div>
            <div class="energy-hud">
                <i data-lucide="zap" class="w-4 h-4 text-cyan-400"></i>
                <div class="energy-bar-bg"><div id="energy-fill"></div></div>
            </div>
        </div>

        <div id="overlay">
            <div class="glass-panel">
                <h1 id="status-title" class="text-5xl font-black font-['Orbitron'] mb-2 italic">NEBULA<br><span class="text-cyan-400">RACER</span></h1>
                <p id="high-score" class="text-[10px] text-purple-400 mb-12 tracking-[0.6em]">RECORDE: 0</p>
                <div class="flex flex-col items-center w-full">
                    <button id="start-btn" class="btn-glow">INICIAR MOTOR</button>
                    <button id="home-btn" class="btn-outline">MENU PRINCIPAL</button>
                </div>
                <div id="controls-info" class="mt-8 text-[10px] text-gray-500 uppercase tracking-widest"></div>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const energyFill = document.getElementById('energy-fill');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('start-btn');
        const homeBtn = document.getElementById('home-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const statusTitle = document.getElementById('status-title');

        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() { if(!audioCtx) audioCtx = new AudioCtx(); if(audioCtx.state === 'suspended') audioCtx.resume(); }

        const sfx = {
            jump: () => { if(!audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type = 'triangle'; o.frequency.setValueAtTime(160, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.2); g.gain.setValueAtTime(0.1, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.2); },
            boost: () => { if(!audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type = 'sawtooth'; o.frequency.setValueAtTime(200 + Math.random()*50, audioCtx.currentTime); g.gain.setValueAtTime(0.03, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.05); },
            point: () => { if(!audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.frequency.setValueAtTime(800, audioCtx.currentTime); g.gain.setValueAtTime(0.05, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.3); },
            crash: () => { if(!audioCtx) return; const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type = 'square'; o.frequency.setValueAtTime(60, audioCtx.currentTime); g.gain.setValueAtTime(0.15, audioCtx.currentTime); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + 0.8); }
        };

        let gameActive = false, isPaused = false, score = 0, frameCount = 0, lastTap = 0;
        let record = localStorage.getItem('nebula_record') || 0;
        document.getElementById('high-score').innerText = `RECORDE: ${record}`;

        let ship = { x: 150, y: 0, w: 50, h: 25, v: 0, g: 0.28, jump: -6.5, boost: 100, isBoosting: false, angle: 0 };
        let pipes = [], stars = [], particles = [];

        function resize() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            stars = Array.from({length: 120}, () => ({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, z: Math.random()*3 + 1, s: Math.random()*2 }));
        }
        window.addEventListener('resize', resize); resize();

        function reset() {
            initAudio();
            ship.y = canvas.height/2; ship.v = 0; ship.boost = 100;
            pipes = []; particles = []; score = 0; frameCount = 0;
            document.getElementById('score-display').innerText = "00";
            gameActive = true; isPaused = false; overlay.classList.add('hidden');
            statusTitle.innerHTML = "NEBULA<br><span class='text-cyan-400'>RACER</span>";
        }

        function die() {
            sfx.crash(); gameActive = false;
            overlay.classList.remove('hidden');
            statusTitle.innerHTML = "MISSÃO<br><span class='text-red-500'>FALHOU</span>";
            if(score > record) { record = score; localStorage.setItem('nebula_record', record); }
            document.getElementById('high-score').innerText = `RECORDE: ${record}`;
            startBtn.innerText = "RECOMECAR";
        }

        function update() {
            if(!gameActive || isPaused) return;
            frameCount++;

            // Ship Logic
            if(ship.isBoosting && ship.boost > 2) {
                ship.v = -4.5; ship.boost -= 1.8;
                if(frameCount % 4 === 0) sfx.boost();
                particles.push({ x: ship.x, y: ship.y + 12, vx: -8, vy: (Math.random()-0.5)*3, life: 1, size: 5, color: '#05ffa1' });
            } else {
                ship.isBoosting = false;
                if(ship.boost < 100) ship.boost += 0.35;
            }
            energyFill.style.width = `${ship.boost}%`;
            ship.v += ship.g; ship.y += ship.v;
            ship.angle = Math.min(Math.PI/6, Math.max(-Math.PI/6, ship.v * 0.05));
            if(ship.y > canvas.height || ship.y < 0) die();

            // Pipes Logic (With Pulsing Gap)
            if(frameCount % 90 === 0 || pipes.length === 0) {
                pipes.push({ 
                    x: canvas.width, 
                    top: Math.random() * (canvas.height - 400) + 100, 
                    gap: 220, 
                    gapDir: 1, // 1 para aumentar, -1 para diminuir
                    w: 90, passed: false, color: score % 2 === 0 ? '#bc13fe' : '#05ffa1' 
                });
            }

            pipes.forEach((p, i) => {
                p.x -= ship.isBoosting ? 12 : 6;
                
                // MOVIMENTAÇÃO DA PASSAGEM (Gap Pulsante)
                p.gap += p.gapDir * 1.5; // Velocidade da pulsação
                if(p.gap > 300 || p.gap < 140) p.gapDir *= -1; // Limites: Abre até 300, fecha até 140

                if(ship.x + 10 < p.x + p.w && ship.x + ship.w - 10 > p.x) {
                    if(ship.y < p.top || ship.y + ship.h > p.top + p.gap) die();
                }
                if(!p.passed && p.x < ship.x) { score++; p.passed = true; document.getElementById('score-display').innerText = score.toString().padStart(2, '0'); sfx.point(); }
                if(p.x + p.w < -100) pipes.splice(i, 1);
            });

            particles.forEach((p, i) => { p.x += p.vx; p.y += p.vy; p.life -= 0.03; if(p.life <= 0) particles.splice(i, 1); });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(s => { s.x -= (ship.isBoosting ? s.z * 4 : s.z); if(s.x < 0) s.x = canvas.width; ctx.fillStyle = `rgba(255,255,255,${s.z/5})`; ctx.fillRect(s.x, s.y, s.s, s.s); });
            particles.forEach(p => { ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill(); });
            ctx.globalAlpha = 1;

            pipes.forEach(p => {
                ctx.shadowBlur = 15; ctx.shadowColor = p.color; ctx.fillStyle = p.color;
                ctx.fillRect(p.x, 0, p.w, p.top); 
                ctx.fillRect(p.x, p.top + p.gap, p.w, canvas.height);
                ctx.shadowBlur = 0;
            });

            ctx.save();
            ctx.translate(ship.x + ship.w/2, ship.y + ship.h/2); ctx.rotate(ship.angle);
            ctx.shadowBlur = 20; ctx.shadowColor = ship.isBoosting ? '#05ffa1' : '#bc13fe';
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.moveTo(25, 0); ctx.lineTo(-20, -15); ctx.lineTo(-12, 0); ctx.lineTo(-20, 15); ctx.closePath(); ctx.fill(); ctx.restore();
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }

        canvas.addEventListener('touchstart', (e) => {
            if(!gameActive || isPaused) return;
            e.preventDefault(); const now = Date.now();
            if(now - lastTap < 250) { ship.isBoosting = true; } else { ship.v = ship.jump; sfx.jump(); }
            lastTap = now;
        }, {passive: false});
        canvas.addEventListener('touchend', () => ship.isBoosting = false);
        startBtn.addEventListener('click', reset);
        homeBtn.addEventListener('click', () => window.location.href = '../../More_options.html');
        pauseBtn.addEventListener('click', () => { if(!gameActive) return; isPaused = !isPaused; overlay.classList.toggle('hidden', !isPaused); if(isPaused) { statusTitle.innerHTML = "PAUSADO"; startBtn.innerText = "RETOMAR"; } });

        document.getElementById('controls-info').innerHTML = isMobile ? "Toque: Salto | Toque Duplo: Boost" : "Espaço: Salto | Shift: Boost";
        lucide.createIcons();
        loop();
    </script>
</body>
</html>
